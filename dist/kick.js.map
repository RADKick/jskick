{"version":3,"file":"kick.js","sources":["../src/constants.js","../src/parsers.js","../src/kick.js","../src/observer.js","../src/bindings.js","../src/view.js","../src/adapter.js","../src/binders.js","../src/export.js"],"sourcesContent":["export const OPTIONS = [\n  //'prefix',\n  'templateDelimiters',\n  'rootInterface',\n  'preloadData',\n  'handler'\n]\n\nexport const EXTENSIONS = [\n  'binders',\n  'formatters',\n  'components',\n  'adapters'\n]","const PRIMITIVE = 0;\nconst KEYPATH = 1;\nconst TEXT = 0;\nconst BINDING = 1;\n\nconst QUOTED_STR = /^'.*'$|^\".*\"$/;\nconst WHITESPACES = ' \\n\\r\\t'.split('');\n\n// Parser and tokenizer for getting the type and value from a string.\nexport function parseType(string) {\n  let type = PRIMITIVE;\n  let value = string;\n\n  if (QUOTED_STR.test(string)) {\n    value = string.slice(1, -1);\n  } else if (string === \"true\") {\n    value = true;\n  } else if (string === \"false\") {\n    value = false;\n  } else if (string === \"null\") {\n    value = null;\n  } else if (string === \"undefined\") {\n    value = undefined;\n  } else if (!isNaN(string)) {\n    value = Number(string);\n  } else {\n    type = KEYPATH;\n  }\n\n  return { type: type, value: value };\n}\n\n// Template parser and tokenizer for mustache-style text content bindings.\n// Parses the template and returns a set of tokens, separating static portions\n// of text from binding declarations.\nexport function parseTemplate(template, delimiters) {\n  var tokens;\n  let length = template.length;\n  let index = 0;\n  let lastIndex = 0;\n  let open = delimiters[0],\n    close = delimiters[1];\n\n  while (lastIndex < length) {\n    index = template.indexOf(open, lastIndex);\n\n    if (index < 0) {\n      if (tokens) {\n        tokens.push({\n          type: TEXT,\n          value: template.slice(lastIndex)\n        });\n      }\n\n      break;\n    } else {\n      tokens || (tokens = []);\n      if (index > 0 && lastIndex < index) {\n        tokens.push({\n          type: TEXT,\n          value: template.slice(lastIndex, index)\n        });\n      }\n\n      lastIndex = index + open.length;\n      index = template.indexOf(close, lastIndex);\n\n      if (index < 0) {\n        let substring = template.slice(lastIndex - close.length);\n        let lastToken = tokens[tokens.length - 1];\n\n        if (lastToken && lastToken.type === TEXT) {\n          lastToken.value += substring;\n        } else {\n          tokens.push({\n            type: TEXT,\n            value: substring\n          });\n        }\n\n        break;\n      }\n\n      let value = template.slice(lastIndex, index).trim();\n\n      tokens.push({\n        type: BINDING,\n        value: value\n      });\n\n      lastIndex = index + close.length;\n    }\n  }\n\n  return tokens;\n}\n\nexport function parseFnExpr(expr) {\n  function jsNested(statement) {\n    var regex = new RegExp(\"([a-zA-Z0-9_$]+)\\\\((.*)\\\\)\", \"g\");\n    var root = { _: [] };\n\n    if (QUOTED_STR.test(statement)) {\n      root._.push({ k: statement, t: \"l\" });\n      return root;\n    }\n\n    var r = regex.exec(statement);\n    if (!r || r.length < 3) {\n      return root;\n    }\n    var parameters = args(r[2]);\n    var node = { _: [] };\n    parameters.forEach(function(p) {\n      if (p.e) {\n        if (p.e.indexOf(\"(\") == -1) {\n          node._.push({ k: p.e, t: \"p\" });\n        } else {\n          var wrappedNode = jsNested(p.e),\n            k;\n          for (k in wrappedNode) {\n            node._.push(wrappedNode[k][0]);\n          }\n        }\n      } else {\n        //node[p.s] = p.s;\n      }\n    });\n\n    // Assign node to the node's identifier\n    root._.push({ k: r[1], t: 'f', _: node._ });\n    //root._.push(r[1]:node);\n    return root;\n  }\n\n  function args(statement) {\n    statement += \",\"; // so I don't have to handle the \"last, leftover parameter\"\n    var results = [];\n    var chars = statement.split(\"\");\n    var level = 0; // levels of parenthesis, used to track how deep I am in ().\n    var index = 0; // determines which parameter am I currently on.\n    var temp = \"\", match = '', temp2 = '';\n    chars.forEach(function(char) {\n      switch (true) {\n        case char === \"'\":\n        case char === '\"':\n          if (match.length && match === char) {\n            temp += match + temp2 + match;\n            results[index] = { s: temp2 };\n            match = temp2 = '';\n            //level--;\n            //temp = '';\n            index++;\n          } else {\n            match = char;\n            //level++;\n          }\n          //level++;\n          break;\n        case !match.length && WHITESPACES.indexOf(char) !== -1:\n          break;\n        case !match.length && char === '(':\n          temp += char;\n          level++;\n          break;\n        case !match.length && char === ')':\n          temp += char;\n          level--;\n          break;\n        case !match.length && char === ',':\n          // if the comma is between a set of parenthesis, ignore.\n          if (level !== 0) {\n            temp += char;\n          }\n          // if the comma is external, split the string.\n          else {\n            results[index] = { e: temp };\n            temp = '';\n            index++;\n          }\n          break;\n        default:\n          if (match.length) {\n            temp2 += char;\n          } else {\n            temp += char;\n          }\n          break;\n      }\n    });\n    return results;\n  }\n\n  //return if we were able to parse functions otherwise it will be null\n  return jsNested(expr)._[0] || null;\n}\n","import {EXTENSIONS} from './constants'\nimport {parseTemplate, parseType} from './parsers'\n\nconst kick = {\n  // Global binders.\n  binders: {},\n\n  // Global formatters.\n  formatters: {},\n\n  // Global components.\n  components: {},\n\n  // Global sightglass adapters.\n  adapters: {},\n\n  /*\n  // Default attribute prefix.\n  _prefix: 'rv',\n\n  _fullPrefix: 'rv-',\n\n  /* get prefix () {\n    return this._prefix\n  },\n\n  set prefix (value) {\n    this._prefix = value\n    this._fullPrefix = value + '-'\n  }, */\n\n  parseTemplate: parseTemplate,\n\n  parseType: parseType,\n\n  // Default template delimiters.\n  templateDelimiters: ['{{', '}}'],\n\n  // Binder shortcuts - extend it if you want to have your own\n  // else if(nodeName === '?') {nodeName = 'if';}\n\n  binderMap: {\n    '^': '^click',\n    '^^': '^dblclick',\n    '^_': '^contextmenu',\n    '@': '@value',\n    '@x': '@checked',\n    ':' : ':text',\n    '::' : ':html',\n    '$' : ':html',\n    '-': ':hide',\n    '+': ':show',\n    '~': ':disabled',\n    '~~': ':enabled'\n    },\n    // was starBinder in rivetsjs, in kickjs *(star) is used for binding so changing it to varBinder is an variable binder\n    varBinderMap: {\n      '.&': ':class-&',\n      '..&': ':style-&',\n      '::&': ':attr-&',\n    },\n  // Default sightglass root interface.\n  rootInterface: '.',\n\n  // Preload data by default.\n  preloadData: true,\n\n  // Default event handler.\n  handler: function(context, ev, binding) {\n    //changing the order of returns as well as passed arguments first then $event\n    //todo document this breakig change\n    const processedArgs = binding.parseFormatterArguments(binding.fnArgs, 0);\n    this.call(context, ...[...processedArgs, binding.view.models, ev])\n  },\n\n  // Sets the attribute on the element. If no binder above is matched it will fall\n  // back to using this binder.\n  fallbackBinder: function(el, value) {\n    if (value != null) {\n      el.setAttribute(this.type, value)\n    } else {\n      el.removeAttribute(this.type)\n    }\n  },\n\n  // Merges an object literal into the corresponding global options.\n  configure: function(options) {\n    if (!options) {\n      return\n    }\n    Object.keys(options).forEach(option => {\n      let value = options[option]\n\n      if (EXTENSIONS.indexOf(option) > -1) {\n        Object.keys(value).forEach(key => {\n          this[option][key] = value[key]\n        })\n      } else {\n        this[option] = value\n      }\n    })\n  }\n}\n\nexport default kick\n","\n// Check if a value is an object than can be observed.\nfunction isObject(obj) {\n  return typeof obj === 'object' && obj !== null\n}\n\n// Error thrower.\nfunction error(message) {\n  throw new Error('[Observer] ' + message)\n}\n\nvar adapters\nvar interfaces\nvar rootInterface\n\n// Constructs a new keypath observer and kicks things off.\nfunction Observer(obj, keypath, callback) {\n  this.keypath = keypath\n  this.callback = callback\n  this.objectPath = []\n  this.parse()\n  this.obj = this.getRootObject(obj)\n\n  if (isObject(this.target = this.realize())) {\n    this.set(true, this.key, this.target, this.callback)\n  }\n}\n\nObserver.updateOptions = function(options) {\n  adapters = options.adapters\n  interfaces = Object.keys(adapters)\n  rootInterface = options.rootInterface\n}\n\n// Tokenizes the provided keypath string into interface + path tokens for the\n// observer to work with.\nObserver.tokenize = function(keypath, root) {\n  var tokens = []\n  var current = {i: root, path: ''}\n  var index, chr\n\n  for (index = 0; index < keypath.length; index++) {\n    chr = keypath.charAt(index)\n\n    if (!!~interfaces.indexOf(chr)) {\n      tokens.push(current)\n      current = {i: chr, path: ''}\n    } else {\n      current.path += chr\n    }\n  }\n\n  tokens.push(current)\n  return tokens\n}\n\n// Parses the keypath using the interfaces defined on the view. Sets variables\n// for the tokenized keypath as well as the end key.\nObserver.prototype.parse = function() {\n  var path, root\n\n  if (!interfaces.length) {\n    error('Must define at least one adapter interface.')\n  }\n\n  if (!!~interfaces.indexOf(this.keypath[0])) {\n    root = this.keypath[0]\n    path = this.keypath.substr(1)\n  } else {\n    root = rootInterface\n    path = this.keypath\n  }\n\n  this.tokens = Observer.tokenize(path, root)\n  this.key = this.tokens.pop()\n}\n\n// Realizes the full keypath, attaching observers for every key and correcting\n// old observers to any changed objects in the keypath.\nObserver.prototype.realize = function() {\n  var current = this.obj\n  var unreached = -1\n  var prev\n  var token\n\n  for (let index = 0; index < this.tokens.length; index++) {\n    token = this.tokens[index]\n    if (isObject(current)) {\n      if (typeof this.objectPath[index] !== 'undefined') {\n        if (current !== (prev = this.objectPath[index])) {\n          this.set(false, token, prev, this)\n          this.set(true, token, current, this)\n          this.objectPath[index] = current\n        }\n      } else {\n        this.set(true, token, current, this)\n        this.objectPath[index] = current\n      }\n\n      current = this.get(token, current)\n    } else {\n      if (unreached === -1) {\n        unreached = index\n      }\n\n      if (prev = this.objectPath[index]) {\n        this.set(false, token, prev, this)\n      }\n    }\n  }\n\n  if (unreached !== -1) {\n    this.objectPath.splice(unreached)\n  }\n\n  return current\n}\n\n// Updates the keypath. This is called when any intermediary key is changed.\nObserver.prototype.sync = function() {\n  var next, oldValue, newValue\n\n  if ((next = this.realize()) !== this.target) {\n    if (isObject(this.target)) {\n      this.set(false, this.key, this.target, this.callback)\n    }\n\n    if (isObject(next)) {\n      this.set(true, this.key, next, this.callback)\n    }\n\n    oldValue = this.value()\n    this.target = next\n    newValue = this.value()\n    if (newValue !== oldValue || newValue instanceof Function) this.callback.sync()\n  } else if (next instanceof Array) {\n    this.callback.sync()\n  }\n}\n\n// Reads the current end value of the observed keypath. Returns undefined if\n// the full keypath is unreachable.\nObserver.prototype.value = function() {\n  if (isObject(this.target)) {\n    return this.get(this.key, this.target)\n  }\n}\n\n// Sets the current end value of the observed keypath. Calling setValue when\n// the full keypath is unreachable is a no-op.\nObserver.prototype.setValue = function(value) {\n  if (isObject(this.target)) {\n    adapters[this.key.i].set(this.target, this.key.path, value)\n  }\n}\n\n// Gets the provided key on an object.\nObserver.prototype.get = function(key, obj) {\n  return adapters[key.i].get(obj, key.path)\n}\n\n// Observes or unobserves a callback on the object using the provided key.\nObserver.prototype.set = function(active, key, obj, callback) {\n  var action = active ? 'observe' : 'unobserve'\n  adapters[key.i][action](obj, key.path, callback)\n}\n\n\n// Unobserves the entire keypath.\nObserver.prototype.unobserve = function() {\n  var obj\n  var token\n\n  for (let index = 0; index < this.tokens.length; index++) {\n    token = this.tokens[index]\n    if (obj = this.objectPath[index]) {\n      this.set(false, token, obj, this)\n    }\n  }\n\n  if (isObject(this.target)) {\n    this.set(false, this.key, this.target, this.callback)\n  }\n}\n// traverse the scope chain to find the scope which has the root property\n// if the property is not found in chain, returns the root scope\nObserver.prototype.getRootObject = function (obj) {\n  var rootProp, current;\n  if (!obj.$parent) {\n    return obj;\n  }\n\n  if (this.tokens.length) {\n    rootProp = this.tokens[0].path\n  } else {\n    rootProp = this.key.path\n  }\n\n  current = obj;\n  while (current.$parent && (current[rootProp] === undefined)) {\n    current = current.$parent\n  }\n\n  return current;\n}\n\nexport default Observer\n","import { parseType, parseFnExpr } from \"./parsers\";\nimport Observer from \"./observer\";\n\nfunction getInputValue(el) {\n  let results = [];\n  if (el.type === \"checkbox\") {\n    return el.checked;\n  } else if (el.type === \"select-multiple\") {\n    el.options.forEach(option => {\n      if (option.selected) {\n        results.push(option.value);\n      }\n    });\n\n    return results;\n  } else {\n    return el.value;\n  }\n}\n\nconst FORMATTER_ARGS = /[^\\s']+|'([^']|'[^\\s])*'|\"([^\"]|\"[^\\s])*\"/g;\nconst FORMATTER_SPLIT = /\\s+/;\nconst FN_CHECK = /\\(.*\\)/;\n\n// A single binding between a model attribute and a DOM element.\nexport class Binding {\n  // All information about the binding is passed into the constructor; the\n  // containing view, the DOM node, the type of binding, the model object and the\n  // keypath at which to listen for changes.\n  constructor(view, el, type, keypath, binder, arg, formatters) {\n    this.view = view;\n    this.el = el;\n    this.type = type;\n    this.keypath = keypath;\n    this.binder = binder;\n    this.arg = arg;\n    this.formatters = formatters;\n    this.formatterObservers = {};\n    this.model = undefined;\n    //newly added for fn args but not sure if this is the right way\n    this.fnArgs = [];\n  }\n\n  // Observes the object keypath\n  observe(obj, keypath) {\n    return new Observer(obj, keypath, this);\n  }\n\n  parseTarget() {\n    if (this.keypath) {\n      let token = parseType(this.keypath);\n\n      if (token.type === 0) {\n        this.value = token.value;\n      } else {\n        if (FN_CHECK.test(this.keypath)) {\n          let fnExpr = parseFnExpr(this.keypath);\n          if (fnExpr) {\n            this.keypath = fnExpr.k;\n            this.fnArgs = fnExpr._.map(x => x.k);\n            //let fnArgs = fnExpr._.map(x => x.k)\n            //this.fnArgs = this.parseFormatterArguments(fnArgs, 0)\n          }\n        }\n        this.observer = this.observe(this.view.models, this.keypath);\n        this.model = this.observer.target;\n      }\n    } else {\n      this.value = undefined;\n    }\n  }\n\n  parseFormatterArguments(args, formatterIndex) {\n    return args.map(parseType).map(({ type, value }, ai) => {\n      if (type === 0) {\n        return value;\n      } else {\n        if (!this.formatterObservers[formatterIndex]) {\n          this.formatterObservers[formatterIndex] = {};\n        }\n\n        let observer = this.formatterObservers[formatterIndex][ai];\n\n        if (!observer) {\n          observer = this.observe(this.view.models, value);\n          this.formatterObservers[formatterIndex][ai] = observer;\n        }\n\n        return observer.value();\n      }\n    });\n  }\n\n  // Applies all the current formatters to the supplied value and returns the\n  // formatted value.\n  formattedValue(value) {\n    return this.formatters.reduce((result, declaration, index) => {\n      let args = declaration.match(FORMATTER_ARGS);\n      let id = args.shift();\n      let formatter = this.view.options.formatters[id];\n\n      const processedArgs = this.parseFormatterArguments(args, index);\n\n      if (formatter && formatter.read instanceof Function) {\n        result = formatter.read(result, ...processedArgs);\n      } else if (formatter instanceof Function) {\n        result = formatter(result, ...processedArgs);\n      }\n      return result;\n    }, value);\n  }\n\n  // Returns an event handler for the binding around the supplied function.\n  eventHandler(fn) {\n    let binding = this;\n    let handler = binding.view.options.handler;\n\n    return function(ev) {\n      handler.call(fn, this, ev, binding);\n    };\n  }\n\n  // Sets the value for the binding. This Basically just runs the binding routine\n  // with the supplied value formatted.\n  set(value) {\n    if (value instanceof Function && !this.binder.function) {\n      //todo update docs, probably a breaking change\n      const processedArgs = this.parseFormatterArguments(this.fnArgs, 0);\n      value = this.formattedValue(\n        value.call(this.model, ...[...processedArgs, this.view.models])\n      );\n      //value = this.formattedValue(value.call(this.model))\n    } else {\n      value = this.formattedValue(value);\n    }\n\n    let routineFn = this.binder.routine || this.binder;\n\n    if (routineFn instanceof Function) {\n      routineFn.call(this, this.el, value);\n    }\n  }\n\n  // Syncs up the view binding with the model.\n  sync() {\n    if (this.observer) {\n      this.model = this.observer.target;\n      this.set(this.observer.value());\n    } else {\n      this.set(this.value);\n    }\n  }\n\n  // Publishes the value currently set on the input element back to the model.\n  publish() {\n    if (this.observer) {\n      var value = this.formatters.reduceRight((result, declaration, index) => {\n        const args = declaration.split(FORMATTER_SPLIT);\n        const id = args.shift();\n        const formatter = this.view.options.formatters[id];\n        const processedArgs = this.parseFormatterArguments(args, index);\n\n        if (formatter && formatter.publish) {\n          result = formatter.publish(result, ...processedArgs);\n        }\n        return result;\n      }, this.getValue(this.el));\n\n      this.observer.setValue(value);\n    }\n  }\n\n  // Subscribes to the model for changes at the specified keypath. Bi-directional\n  // routines will also listen for changes on the element to propagate them back\n  // to the model.\n  bind() {\n    this.parseTarget();\n\n    if (this.binder.hasOwnProperty(\"bind\")) {\n      this.binder.bind.call(this, this.el);\n    }\n\n    if (this.view.options.preloadData) {\n      this.sync();\n    }\n  }\n\n  // Unsubscribes from the model and the element.\n  unbind() {\n    if (this.binder.unbind) {\n      this.binder.unbind.call(this, this.el);\n    }\n\n    if (this.observer) {\n      this.observer.unobserve();\n    }\n\n    Object.keys(this.formatterObservers).forEach(fi => {\n      let args = this.formatterObservers[fi];\n\n      Object.keys(args).forEach(ai => {\n        args[ai].unobserve();\n      });\n    });\n\n    this.formatterObservers = {};\n  }\n\n  // Updates the binding's model from what is currently set on the view. Unbinds\n  // the old model first and then re-binds with the new model.\n  update(models = {}) {\n    if (this.observer) {\n      this.model = this.observer.target;\n    }\n\n    if (this.binder.update) {\n      this.binder.update.call(this, models);\n    }\n  }\n\n  // Returns elements value\n  getValue(el) {\n    if (this.binder && this.binder.getValue) {\n      return this.binder.getValue.call(this, el);\n    } else {\n      return getInputValue(el);\n    }\n  }\n}\n","import kick from './kick'\nimport {Binding} from './bindings'\nimport {parseTemplate} from './parsers'\n//import ComponentBinding from './components'\n\nconst textBinder = {\n  routine: (node, value) => {\n    node.data = (value != null) ? value : ''\n  }\n}\n\nconst DECLARATION_SPLIT = /((?:'[^']*')*(?:(?:[^\\|']*(?:'[^']*')+[^\\|']*)+|[^\\|]+))|^$/g\nconst ESCAPE_BINDER = /[.*+?^${}()|[\\]\\\\]/g\nconst ESCAPE_BINDER_WITH = '\\\\$&'\nconst binderPrefixes = '@:^.-+?!*#$~'.split('')\n\n\nconst parseNode = (view, node) => {\n  let block = false\n\n  if (node.nodeType === 3) {\n    let tokens = parseTemplate(node.data, kick.templateDelimiters)\n\n    if (tokens) {\n      for (let i = 0; i < tokens.length; i++) {\n        let token = tokens[i]\n        let text = document.createTextNode(token.value)\n        node.parentNode.insertBefore(text, node)\n\n        if (token.type === 1) {\n          view.buildBinding(text, null, token.value, textBinder, null)\n        }\n      }\n\n      node.parentNode.removeChild(node)\n    }\n    block = true\n  } else if (node.nodeType === 1) {\n    block = view.traverse(node)\n  }\n\n  if (!block) {\n    for (let i = 0; i < node.childNodes.length; i++) {\n      parseNode(view, node.childNodes[i]);\n    }\n  }\n}\n\nconst bindingComparator = (a, b) => {\n  let aPriority = a.binder ? (a.binder.priority || 0) : 0\n  let bPriority = b.binder ? (b.binder.priority || 0) : 0\n  return bPriority - aPriority\n}\n\nconst trimStr = (str) => {\n  return str.trim()\n}\n\n// A collection of bindings built from a set of parent nodes.\nexport default class View {\n  // The DOM elements and the model objects for binding are passed into the\n  // constructor along with any local options that should be used throughout the\n  // context of the view and it's bindings.\n  constructor(els, models, options) {\n    if (els.jquery || els instanceof Array) {\n      this.els = els\n    } else {\n      this.els = [els]\n    }\n\n    this.models = models\n    this.options = options\n\n    this.build()\n  }\n\n\n  buildBinding(node, type, declaration, binder, arg) {\n    let pipes = declaration.match(DECLARATION_SPLIT).map(trimStr)\n\n    let keypath = pipes.shift()\n\n    if(arg === '' && type === '*'){\n      //resolve for in expression, useful for case sensitive members e.g. myItem in items\n      const forRE = new RegExp(/^(.+)\\s+in\\s+(.[^|\\s]+)(.*)$/gm);\n      let forExp = forRE.exec(keypath);\n      // console.log(forExp)\n      if(forExp && forExp.length > 2){\n        arg = forExp[1] || arg\n        keypath = forExp[2] || keypath\n      }\n      // console.log(forExp[3].split('|'))\n    }\n\n    this.bindings.push(new Binding(this, node, type, keypath, binder, arg, pipes))\n  }\n\n  // Parses the DOM tree and builds `Binding` instances for every matched\n  // binding declaration.\n  build() {\n    this.bindings = []\n\n    let elements = this.els, i, len;\n    for (i = 0, len = elements.length; i < len; i++) {\n      parseNode(this, elements[i])\n    }\n\n    this.bindings.sort(bindingComparator)\n  }\n\n  traverse(node) {\n    // let bindingPrefix = kick._fullPrefix\n    let block = node.nodeName === 'SCRIPT' || node.nodeName === 'STYLE'\n    let attributes = node.attributes\n    let bindInfos = []\n    let varBinders = this.options.varBinders\n    let mappedBinder\n    var binderType, binder, identifier, arg\n\n    for (let i = 0, len = attributes.length; i < len; i++) {\n      let attribute = attributes[i]\n      // if (attribute.name.indexOf(bindingPrefix) === 0) {\n      if (this.startWithBinder(attribute.name)) {\n          // binderType = attribute.name.slice(bindingPrefix.length);\n          mappedBinder = kick.binderMap[attribute.name];\n          binderType = mappedBinder || attribute.name;\n\n        // type = attribute.name.slice(bindingPrefix.length)\n        binder = this.options.binders[binderType]\n        arg = undefined\n\n        if (!binder) {\n          for (let k = 0; k < varBinders.length; k++) {\n            identifier = varBinders[k]\n            if (binderType.slice(0, identifier.length - 1) === identifier.slice(0, -1)) {\n              binder = this.options.binders[identifier]\n              arg = binderType.slice(identifier.length - 1)\n              break\n            }\n          }\n        }\n\n        if (!binder) {\n          binder = kick.fallbackBinder\n        }\n\n        if (binder.block) {\n          this.buildBinding(node, binderType, attribute.value, binder, arg)\n          node.removeAttribute(attribute.name)\n          return true;\n        }\n\n        bindInfos.push({attr: attribute, binder: binder, type: binderType, arg: arg})\n      }\n    }\n\n    for (let i = 0; i < bindInfos.length; i++) {\n      let bindInfo = bindInfos[i]\n      this.buildBinding(node, bindInfo.type, bindInfo.attr.value, bindInfo.binder, bindInfo.arg)\n      node.removeAttribute(bindInfo.attr.name)\n    }\n\n    if (kick.components[binderType] && !node._bound) {\n       this.bindings.push(new ComponentBinding(this, node, binderType));\n       block = true;\n    }\n\n    return block\n  }\n\n  // Binds all of the current bindings for this view.\n  bind() {\n    this.bindings.forEach(binding => {\n      binding.bind()\n    })\n  }\n\n  // Unbinds all of the current bindings for this view.\n  unbind() {\n    this.bindings.forEach(binding => {\n      binding.unbind()\n    })\n  }\n\n  // Syncs up the view with the model by running the routines on all bindings.\n  sync() {\n    this.bindings.forEach(binding => {\n      binding.sync()\n    })\n  }\n\n  // Publishes the input values from the view back to the model (reverse sync).\n  publish() {\n    this.bindings.forEach(binding => {\n      if (binding.binder && binding.binder.publishes) {\n        binding.publish()\n      }\n    })\n  }\n\n  // Updates the view's models along with any affected bindings.\n  update(models = {}) {\n    Object.keys(models).forEach(key => {\n      this.models[key] = models[key]\n    })\n\n    this.bindings.forEach(binding => {\n      if (binding.update) {\n        binding.update(models)\n      }\n    })\n  }\n\n  // move it to utils\n  startWithBinder(name) {\n    const prefix = name.substr(0, 1)\n    return binderPrefixes.some((pre) => pre === prefix)\n  }\n}\n","// The default `.` adapter that comes with kick.js. Allows subscribing to\n// properties on plain objects, implemented in ES5 natives using\n// `Object.defineProperty`.\n\nconst ARRAY_METHODS = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'sort',\n  'reverse',\n  'splice'\n]\n\nconst adapter = {\n  counter: 0,\n  weakmap: {},\n\n  weakReference: function(obj) {\n    if (!obj.hasOwnProperty('__rv')) {\n      let id = this.counter++\n\n      Object.defineProperty(obj, '__rv', {\n        value: id\n      })\n    }\n\n    if (!this.weakmap[obj.__rv]) {\n      this.weakmap[obj.__rv] = {\n        callbacks: {}\n      }\n    }\n\n    return this.weakmap[obj.__rv]\n  },\n\n  cleanupWeakReference: function(ref, id) {\n    if (!Object.keys(ref.callbacks).length) {\n      if (!(ref.pointers && Object.keys(ref.pointers).length)) {\n        delete this.weakmap[id]\n      }\n    }\n  },\n\n  stubFunction: function(obj, fn) {\n    let original = obj[fn]\n    let map = this.weakReference(obj)\n    let weakmap = this.weakmap\n\n    obj[fn] = (...args) => {\n      let response = original.apply(obj, args)\n\n      Object.keys(map.pointers).forEach(r => {\n        let k = map.pointers[r]\n\n        if (weakmap[r]) {\n          if (weakmap[r].callbacks[k] instanceof Array) {\n            weakmap[r].callbacks[k].forEach(callback => {\n              callback.sync()\n            })\n          }\n        }\n      })\n\n      return response\n    }\n  },\n\n  observeMutations: function(obj, ref, keypath) {\n    if (obj instanceof Array) {\n      let map = this.weakReference(obj)\n\n      if (!map.pointers) {\n        map.pointers = {}\n\n        ARRAY_METHODS.forEach(fn => {\n          this.stubFunction(obj, fn)\n        })\n      }\n\n      if (!map.pointers[ref]) {\n        map.pointers[ref] = []\n      }\n\n      if (map.pointers[ref].indexOf(keypath) === -1) {\n        map.pointers[ref].push(keypath)\n      }\n    }\n  },\n\n  unobserveMutations: function(obj, ref, keypath) {\n    if ((obj instanceof Array) && (obj.__rv != null)) {\n      let map = this.weakmap[obj.__rv]\n\n      if (map) {\n        let pointers = map.pointers[ref]\n\n        if (pointers) {\n          let idx = pointers.indexOf(keypath)\n\n          if (idx > -1) {\n            pointers.splice(idx, 1)\n          }\n\n          if (!pointers.length) {\n            delete map.pointers[ref]\n          }\n\n          this.cleanupWeakReference(map, obj.__rv)\n        }\n      }\n    }\n  },\n\n  observe: function(obj, keypath, callback) {\n    var value;\n    let callbacks = this.weakReference(obj).callbacks\n\n    if (!callbacks[keypath]) {\n      callbacks[keypath] = []\n      let desc = Object.getOwnPropertyDescriptor(obj, keypath)\n\n      if (!desc || !(desc.get || desc.set || !desc.configurable)) {\n        value = obj[keypath]\n\n        Object.defineProperty(obj, keypath, {\n          enumerable: true,\n\n          get: () => {\n            return value\n          },\n\n          set: newValue => {\n            if (newValue !== value) {\n              this.unobserveMutations(value, obj.__rv, keypath)\n              value = newValue\n              let map = this.weakmap[obj.__rv]\n\n              if (map) {\n                let callbacks = map.callbacks[keypath]\n\n                if (callbacks) {\n                  callbacks.forEach(cb => {\n                      cb.sync()\n                  })\n                }\n\n                this.observeMutations(newValue, obj.__rv, keypath)\n              }\n            }\n          }\n        })\n      }\n    }\n\n    if (callbacks[keypath].indexOf(callback) === -1) {\n      callbacks[keypath].push(callback)\n    }\n\n    this.observeMutations(obj[keypath], obj.__rv, keypath)\n  },\n\n  unobserve: function(obj, keypath, callback) {\n    let map = this.weakmap[obj.__rv]\n\n    if (map) {\n      let callbacks = map.callbacks[keypath]\n\n      if (callbacks) {\n        let idx = callbacks.indexOf(callback)\n\n        if (idx > -1) {\n          callbacks.splice(idx, 1)\n\n          if (!callbacks.length) {\n            delete map.callbacks[keypath]\n            this.unobserveMutations(obj[keypath], obj.__rv, keypath)\n          }\n        }\n\n        this.cleanupWeakReference(map, obj.__rv)\n      }\n    }\n  },\n\n  get: function(obj, keypath) {\n    return obj[keypath]\n  },\n\n  set: (obj, keypath, value) => {\n    obj[keypath] = value\n  }\n}\n\nexport default adapter\n","import View from './view'\nimport kick from './kick';\n\nconst getString = (value) => {\n  return value != null ? value.toString() : undefined\n}\n\nconst times = (n, cb) => {\n  for (let i = 0; i < n; i++) cb()\n}\n\nfunction createView(binding, data, anchorEl) {\n  let template = binding.el.cloneNode(true)\n  let view = new View(template, data, binding.view.options)\n  view.bind()\n  binding.marker.parentNode.insertBefore(template, anchorEl)\n  return view\n}\n\nconst binders = {\n  // Binds an event handler on the element.\n  '^&': {\n    function: true,\n    priority: 1000,\n\n    unbind: function(el) {\n      if (this.handler) {\n        el.removeEventListener(this.arg, this.handler)\n      }\n    },\n\n    routine: function(el, value) {\n      if (this.handler) {\n        el.removeEventListener(this.arg, this.handler)\n      }\n\n      this.handler = this.eventHandler(value)\n      el.addEventListener(this.arg, this.handler)\n    }\n  },\n\n  // for $item Appends bound instances of the element in place for item in the array.\n  '*&': {\n    block: true,\n\n    priority: 4000,\n\n    bind: function(el) {\n      if (!this.marker) {\n        this.marker = document.createComment(` kick: ${this.type} `)\n        this.iterated = []\n\n        el.parentNode.insertBefore(this.marker, el)\n        el.parentNode.removeChild(el)\n      } else {\n        this.iterated.forEach(view => {\n          view.bind()\n        })\n      }\n    },\n\n    unbind: function(el) {\n      if (this.iterated) {\n        this.iterated.forEach(view => {\n          view.unbind()\n        })\n      }\n    },\n\n    routine: function(el, collection) {\n      let modelName = this.arg || '$item'\n      collection = collection || []\n      let indexProp = el.getAttribute('#index') || el.getAttribute('index-property') || '$index'\n\n      collection.forEach((model, index) => {\n        let data = {$parent: this.view.models}\n        data[indexProp] = index\n        data[modelName] = model\n        let view = this.iterated[index]\n\n        if (!view) {\n\n          let previous = this.marker\n\n          if (this.iterated.length) {\n            previous = this.iterated[this.iterated.length - 1].els[0]\n          }\n\n          view = createView(this, data, previous.nextSibling)\n          this.iterated.push(view)\n        } else {\n          if (view.models[modelName] !== model) {\n            // search for a view that matches the model\n            let matchIndex, nextView\n            for (let nextIndex = index + 1; nextIndex < this.iterated.length; nextIndex++) {\n              nextView = this.iterated[nextIndex]\n              if (nextView.models[modelName] === model) {\n                matchIndex = nextIndex\n                break\n              }\n            }\n            if (matchIndex !== undefined) {\n              // model is in other position\n              // todo: consider avoiding the splice here by setting a flag\n              // profile performance before implementing such change\n              this.iterated.splice(matchIndex, 1)\n              this.marker.parentNode.insertBefore(nextView.els[0], view.els[0])\n              nextView.models[indexProp] = index\n            } else {\n              //new model\n              nextView = createView(this, data, view.els[0])\n            }\n            this.iterated.splice(index, 0, nextView)\n          } else {\n            view.models[indexProp] = index\n          }\n        }\n      })\n\n      if (this.iterated.length > collection.length) {\n        times(this.iterated.length - collection.length, () => {\n          let view = this.iterated.pop()\n          view.unbind()\n          this.marker.parentNode.removeChild(view.els[0])\n        })\n      }\n\n      if (el.nodeName === 'OPTION') {\n        this.view.bindings.forEach(binding => {\n          if (binding.el === this.marker.parentNode && binding.type === 'value') {\n            binding.sync()\n          }\n        })\n      }\n    },\n\n    update: function(models) {\n      let data = {}\n\n      //todo: add test and fix if necessary\n\n      Object.keys(models).forEach(key => {\n        if (key !== this.arg) {\n          data[key] = models[key]\n        }\n      })\n\n      this.iterated.forEach(view => {\n        view.update(data)\n      })\n    }\n  },\n\n  // Order of ..& should be before .& otherwise match will trigger shorter length first\n  '..&': function(el, value) {\n    const propertyName = this.arg;\n    if (value) {\n      el.style[propertyName] = value;\n    } else {\n      el.style[propertyName] = '';\n    }\n  },\n\n  // Adds or removes the class from the element when value is true or false.\n  '.&': function(el, value) {\n    let elClass = ` ${el.className} `\n\n    if (!value === (elClass.indexOf(` ${this.arg} `) > -1)) {\n      if (value) {\n        el.className = `${el.className} ${this.arg}`\n      } else {\n        el.className = elClass.replace(` ${this.arg} `, ' ').trim()\n      }\n    }\n  },\n\n  // Sets the element's text value.\n  ':text': (el, value) => {\n    el.textContent = value != null ? value : ''\n  },\n\n  // Sets the element's HTML content.\n  ':html': (el, value) => {\n    el.innerHTML = value != null ? value : ''\n  },\n\n  // Shows the element when value is true.\n  ':show': (el, value) => {\n    el.style.display = value ? '' : 'none'\n  },\n\n  // Hides the element when value is true (negated version of `show` binder).\n  ':hide': (el, value) => {\n    el.style.display = value ? 'none' : ''\n  },\n\n  // Enables the element when value is true.\n  ':enabled': (el, value) => {\n    el.disabled = !value\n  },\n\n  // Disables the element when value is true (negated version of `enabled` binder).\n  ':disabled': (el, value) => {\n    el.disabled = !!value\n  },\n\n  // Checks a checkbox or radio input when the value is true. Also sets the model\n  // property when the input is checked or unchecked (two-way binder).\n  '@checked': {\n    publishes: true,\n    priority: 2000,\n\n    bind: function(el) {\n      var self = this;\n      if (!this.callback) {\n        this.callback = function () {\n          self.publish();\n        }\n      }\n      el.addEventListener('change', this.callback)\n    },\n\n    unbind: function(el) {\n      el.removeEventListener('change', this.callback)\n    },\n\n    routine: function(el, value) {\n      if (el.type === 'radio') {\n        el.checked = getString(el.value) === getString(value)\n      } else {\n        el.checked = !!value\n      }\n    }\n  },\n\n  // Sets the element's value. Also sets the model property when the input changes\n  // (two-way binder).\n  '@value': {\n    publishes: true,\n    priority: 3000,\n\n    bind: function(el) {\n      this.isRadio = el.tagName === 'INPUT' && el.type === 'radio';\n      if (!this.isRadio) {\n        this.event = el.getAttribute('event-name') || (el.tagName === 'SELECT' ? 'change' : 'input')\n\n        var self = this;\n        if (!this.callback) {\n          this.callback = function () {\n            self.publish();\n          }\n        }\n\n        el.addEventListener(this.event, this.callback)\n      }\n    },\n\n    unbind: function(el) {\n      if (!this.isRadio) {\n        el.removeEventListener(this.event, this.callback)\n      }\n    },\n\n    routine: function(el, value) {\n      if (this.isRadio) {\n        el.setAttribute('value', value)\n      } else {\n        if (el.type === 'select-multiple') {\n          if (value instanceof Array) {\n            for (let i = 0; i < el.length; i++) {\n              let option = el[i];\n              option.selected = value.indexOf(option.value) > -1\n            }\n          }\n        } else if (getString(value) !== getString(el.value)) {\n          el.value = value != null ? value : ''\n        }\n      }\n    }\n  },\n\n  // Inserts and binds the element and it's child nodes into the DOM when true.\n  '?': {\n    block: true,\n    priority: 4000,\n\n    bind: function(el) {\n      if (!this.marker) {\n        this.marker = document.createComment(' kick: ' + this.type + ' ' + this.keypath + ' ');\n        this.attached = false\n\n        el.parentNode.insertBefore(this.marker, el)\n        el.parentNode.removeChild(el)\n      } else if (this.bound === false && this.nested) {\n        this.nested.bind()\n      }\n      this.bound = true\n    },\n\n    unbind: function() {\n      if (this.nested) {\n        this.nested.unbind()\n        this.bound = false\n      }\n    },\n\n    routine: function(el, value) {\n      if (!!value !== this.attached) {\n        if (value) {\n\n          if (!this.nested) {\n            this.nested = new View(el, this.view.models, this.view.options)\n            this.nested.bind()\n          }\n\n          this.marker.parentNode.insertBefore(el, this.marker.nextSibling)\n          this.attached = true\n        } else {\n          el.parentNode.removeChild(el)\n          this.attached = false\n        }\n      }\n    },\n\n    update: function(models) {\n      if (this.nested) {\n        this.nested.update(models)\n      }\n    }\n  },\n  '::&': function(el, value) {\n    if (value != null) {\n      el.setAttribute(this.arg, value)\n    } else {\n      el.removeAttribute(this.arg)\n    }\n  }\n}\n\nexport default binders\n","import kick from './kick'\nimport View from './view'\nimport {OPTIONS, EXTENSIONS} from './constants'\nimport adapter from './adapter'\nimport binders from './binders'\nimport Observer from './observer'\n//import components from './components'\n\n// Returns the public interface.\n\nkick.binders = binders\n//kick.components = components\nkick.adapters['.'] = adapter\n\n// Binds some data to a template / element. Returns a kick.View instance.\nkick.bind = (elm, models, options) => {\n  // if element then return itself\n  elm = elm || '[kick-app]';\n  let el = (elm.nodeType && elm.nodeType > 0) ? elm : document.querySelector(elm);\n\n  let viewOptions = {}\n  models = models || {}\n  options = options || {}\n\n  EXTENSIONS.forEach(extensionType => {\n    viewOptions[extensionType] = Object.create(null)\n\n    if (options[extensionType]) {\n      Object.keys(options[extensionType]).forEach(key => {\n        viewOptions[extensionType][key] = options[extensionType][key]\n      })\n    }\n\n    Object.keys(kick[extensionType]).forEach(key => {\n      if (!viewOptions[extensionType][key]) {\n        viewOptions[extensionType][key] = kick[extensionType][key]\n      }\n    })\n  })\n\n  OPTIONS.forEach(option => {\n    let value = options[option]\n    viewOptions[option] = value != null ? value : kick[option]\n  })\n\n  viewOptions.varBinders = Object.keys(viewOptions.binders).filter(function (key) {\n    return key.indexOf('&') > 0\n  })\n\n  Observer.updateOptions(viewOptions)\n\n  let view = new View(el, models, viewOptions)\n  view.bind()\n  return view\n}\n\n// Initializes a new instance of a component on the specified element and\n// returns a View instance.\nkick.init = (component, el, data = {}) => {\n  if (el == null) { el = document.createElement('div'); }\n  component = kick.components[component];\n  let template = component.template.call(kick, el);\n  if (template instanceof HTMLElement) {\n    while (el.firstChild) {\n      el.removeChild(el.firstChild);\n    }\n    el.appendChild(template);\n  } else {\n    el.innerHTML = template;\n  }\n  const scope = component.initialize.call(kick, el, data);\n\n  let view = new View(el, scope)\n  view.bind()\n  return view\n}\n\n\nkick.formatters.negate = kick.formatters.not = (value) => {\n  return !value;\n};\n\nkick.formatters.call = (value, ...args) => {\n  if(!args.length) {return;}\n  let fn = args[0]\n  args = Array.prototype.slice.call(args, 1)\n  //value.call(...args)\n  return fn.call(value, ...args)\n  /* fix later if needs to be\n  return () => {\n      return fn.apply(null, value, ...args);\n  }\n  */\n}\n\nexport default kick\n"],"names":["OPTIONS","EXTENSIONS","PRIMITIVE","KEYPATH","TEXT","BINDING","QUOTED_STR","WHITESPACES","split","parseType","string","type","value","test","slice","undefined","isNaN","Number","parseTemplate","template","delimiters","tokens","length","index","lastIndex","open","close","indexOf","push","substring","lastToken","trim","parseFnExpr","expr","jsNested","statement","regex","RegExp","root","_","k","t","r","exec","parameters","args","node","forEach","p","e","wrappedNode","results","chars","level","temp","match","temp2","char","s","kick","binders","formatters","components","adapters","templateDelimiters","binderMap","varBinderMap","rootInterface","preloadData","handler","context","ev","binding","processedArgs","parseFormatterArguments","fnArgs","call","view","models","fallbackBinder","el","setAttribute","removeAttribute","configure","options","Object","keys","option","key","isObject","obj","error","message","Error","interfaces","Observer","keypath","callback","objectPath","parse","getRootObject","target","realize","set","updateOptions","tokenize","current","i","path","chr","charAt","prototype","substr","pop","unreached","prev","token","get","splice","sync","next","oldValue","newValue","Function","Array","setValue","active","action","unobserve","rootProp","$parent","getInputValue","checked","selected","FORMATTER_ARGS","FORMATTER_SPLIT","FN_CHECK","Binding","binder","arg","formatterObservers","model","observe","parseTarget","fnExpr","map","x","observer","formatterIndex","ai","formattedValue","reduce","result","declaration","id","shift","formatter","read","eventHandler","fn","function","routineFn","routine","publish","reduceRight","getValue","bind","hasOwnProperty","unbind","fi","update","textBinder","data","DECLARATION_SPLIT","binderPrefixes","parseNode","block","nodeType","text","document","createTextNode","parentNode","insertBefore","buildBinding","removeChild","traverse","childNodes","bindingComparator","a","b","aPriority","priority","bPriority","trimStr","str","View","els","jquery","build","pipes","forRE","forExp","bindings","elements","len","sort","nodeName","attributes","bindInfos","varBinders","mappedBinder","binderType","identifier","attribute","startWithBinder","name","attr","bindInfo","_bound","ComponentBinding","publishes","prefix","some","pre","ARRAY_METHODS","adapter","counter","weakmap","weakReference","defineProperty","__rv","callbacks","cleanupWeakReference","ref","pointers","stubFunction","original","response","apply","observeMutations","unobserveMutations","idx","desc","getOwnPropertyDescriptor","configurable","enumerable","cb","getString","toString","times","n","createView","anchorEl","cloneNode","marker","removeEventListener","addEventListener","createComment","iterated","collection","modelName","indexProp","getAttribute","previous","nextSibling","matchIndex","nextView","nextIndex","propertyName","style","elClass","className","replace","textContent","innerHTML","display","disabled","self","isRadio","tagName","event","attached","bound","nested","elm","querySelector","viewOptions","extensionType","create","filter","init","component","createElement","HTMLElement","firstChild","appendChild","scope","initialize","negate","not"],"mappings":"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"}